<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Linear Advance | Marlin 3D Printer Firmware</title> <meta property="og:title" content="Linear Advance"> <meta name="author" content="Sebastianv650"> <meta property="og:locale" content="en_US"> <meta name="description" content="Nozzle pressure control to improve print quality"> <meta property="og:description" content="Nozzle pressure control to improve print quality"> <link rel="canonical" href="http://marlinfw.org/docs/features/lin_advance.html"> <meta property="og:url" content="http://marlinfw.org/docs/features/lin_advance.html"> <meta property="og:site_name" content="Marlin 3D Printer Firmware"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2017-05-16T09:28:36+01:00"> <script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Linear Advance","author":{"@type":"Person","name":"Sebastianv650"},"datePublished":"2017-05-16T09:28:36+01:00","dateModified":"2017-05-16T09:28:36+01:00","description":"Nozzle pressure control to improve print quality","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://marlinfw.org/assets/images/logo/marlin/small.png"},"name":"Sebastianv650"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://marlinfw.org/docs/features/lin_advance.html"},"url":"http://marlinfw.org/docs/features/lin_advance.html"}</script> <link rel="icon" href="/assets/favicon.ico"> <link rel="stylesheet" href="/assets/stylesheets/main.css"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]--> <script src="/assets/javascript/head.min.js"></script> <script type="text/javascript">
      /**
       * As Github pages do not support https for custom domains
       * this is the current best workaround for #18.
       */
      var domains  = ['marlinfw.org', 'localhost', '127.0.0.1' ];
      var pathname = location.pathname.replace(/^\/MarlinDocumentation/, '')
      if (domains.indexOf(window.location.hostname) == -1)
          window.top.location.href = 'http://marlinfw.org' + pathname;

      /**
       * Another ugly workaround trying to improve UX reported by #35
       */
       if (location.protocol != 'http:')
           location.href = 'http:' + window.location.href.substring(window.location.protocol.length);

      /**
       * Improves overall speed by loading javascript and css resources in parallel
       * with the main page.
       */
      head.load(
          "/assets/stylesheets/font-awesome.min.css",

          "/assets/javascript/jquery-2.2.1.min.js",
          "/assets/javascript/jquery-ui.min.js",
          "/assets/javascript/bootstrap.min.js",
          "/assets/javascript/tocify.min.js",
          "/assets/javascript/custom.js",

          "/assets/javascript/sheetrock.min.js",
          "/assets/javascript/cookieconsent.min.js"
      );

      head.ready(function() {
        window.cookieconsent_options = {
          "message":"We uses cookies to ensure you get the best experience on our website",
          "dismiss": "Got it!", "learnMore": "More info", "link":"", "theme": "dark-bottom"
        };
      });
    </script> </head> <body role="document"> <nav class="navbar navbar-default navbar-fixed-top custom-no-margin"> <div class="container"> <div class="navbar-header"> <a href="/" class="navbar-brand"> <img src="/assets/images/logo/marlin/text-25.png" alt="Marlin"> </a> <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> </div> <div class="navbar-collapse collapse" id="navbar-main"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-getting-started"> Getting Started <span class="caret"></span> </a> <ul class="dropdown-menu"> <li><a href="/docs/basics/introduction.html"> Introduction </a></li> <li class="divider"> </li> <li><a href="/meta/download/"> Download Marlin </a></li> <li><a href="/docs/basics/install.html"> Installing Marlin </a></li> <li><a href="/docs/configuration/configuration.html"> Configuring Marlin </a></li> <li class="divider"> </li> <li><a href="/docs/basics/reporting_bugs.html"> Reporting bugs </a></li> </ul> </li> <li><a href="/meta/download/"> Download </a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-documentation"> Documentation <span class="caret"></span> </a> <ul class="dropdown-menu"> <li class="dropdown-submenu configuration"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration</a> <ul class="dropdown-menu"> <li><a href="/meta/configuration/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/configuration/configuration.html"> Configuring Marlin 1.1 </a></li> <li><a href="/docs/configuration/laser_spindle.html"> Laser/Spindle Configuration </a></li> <li><a href="/docs/configuration/probes.html"> Probe Configuration </a></li> </ul> </li> <li class="dropdown-submenu development"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development</a> <ul class="dropdown-menu"> <li><a href="/meta/development/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/development/boards.html"> Boards </a></li> <li><a href="/docs/development/coding_standards.html"> Coding Standards </a></li> <li><a href="/docs/development/contributing.html"> Contributing to Marlin </a></li> <li><a href="/docs/development/getting_started_pull_requests.html"> Contributing Code with Pull Requests </a></li> <li><a href="/docs/development/feature_request.html"> Feature requests </a></li> <li><a href="/docs/development/fonts.html"> Adding new fonts </a></li> </ul> </li> <li class="dropdown-submenu gcode"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">G-Code</a> <ul class="dropdown-menu"> <li><a href="/meta/gcode/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/gcode/G000-G001.html"> G0-G1: Linear Move </a></li> <li><a href="/docs/gcode/G002-G003.html"> G2-G3: Controlled Arc Move </a></li> <li><a href="/docs/gcode/G004.html"> G4: Dwell </a></li> <li><a href="/docs/gcode/G005.html"> G5: BÃ©zier cubic spline </a></li> <li><a href="/docs/gcode/G010.html"> G10: Retract </a></li> <li><a href="/docs/gcode/G011.html"> G11: Recover </a></li> <li><a href="/docs/gcode/G012.html"> G12: Clean the Nozzle </a></li> <li><a href="/docs/gcode/G020.html"> G20: Inch Units </a></li> <li><a href="/docs/gcode/G021.html"> G21: Millimeter Units </a></li> <li><a href="/docs/gcode/G026.html"> G26: Mesh Validation Pattern </a></li> <li><a href="/docs/gcode/G027.html"> G27: Park the nozzle </a></li> <li><a href="/docs/gcode/G028.html"> G28: Auto Home </a></li> <li><a href="/docs/gcode/G029-mbl.html"> G29: Mesh Bed Leveling </a></li> <li><a href="/docs/gcode/G029-abl.html"> G29: Automatic Bed Leveling </a></li> <li><a href="/docs/gcode/G029-ubl.html"> G29: Unified Bed Leveling </a></li> <li><a href="/docs/gcode/G030.html"> G30: Single Z-Probe </a></li> <li><a href="/docs/gcode/G031.html"> G31: Dock Sled </a></li> <li><a href="/docs/gcode/G032.html"> G32: Undock Sled </a></li> <li><a href="/docs/gcode/G033.html"> G33: Delta Auto Calibration </a></li> <li><a href="/docs/gcode/G038.html"> G38.2-G38.3: Probe target </a></li> <li><a href="/docs/gcode/G090.html"> G90: Absolute Positioning </a></li> <li><a href="/docs/gcode/G091.html"> G91: Relative Positioning </a></li> <li><a href="/docs/gcode/G092.html"> G92: Set Position </a></li> <li><a href="/docs/gcode/M000-M001.html"> M0-M1: Unconditional stop </a></li> <li><a href="/docs/gcode/M017.html"> M17: Enable Steppers </a></li> <li><a href="/docs/gcode/M018.html"> M18-M84: Disable steppers </a></li> <li><a href="/docs/gcode/M020.html"> M20: List SD Card </a></li> <li><a href="/docs/gcode/M021.html"> M21: Init SD card </a></li> <li><a href="/docs/gcode/M022.html"> M22: Release SD card </a></li> <li><a href="/docs/gcode/M023.html"> M23: Select SD file </a></li> <li><a href="/docs/gcode/M024.html"> M24: Start or Resume SD print </a></li> <li><a href="/docs/gcode/M025.html"> M25: Pause SD print </a></li> <li><a href="/docs/gcode/M026.html"> M26: Set SD position </a></li> <li><a href="/docs/gcode/M027.html"> M27: Report SD print status </a></li> <li><a href="/docs/gcode/M028.html"> M28: Start SD write </a></li> <li><a href="/docs/gcode/M029.html"> M29: Stop SD write </a></li> <li><a href="/docs/gcode/M030.html"> M30: Delete SD file </a></li> <li><a href="/docs/gcode/M031.html"> M31: Print time </a></li> <li><a href="/docs/gcode/M032.html"> M32: Select and Start </a></li> <li><a href="/docs/gcode/M033.html"> M33: Get Long Path </a></li> <li><a href="/docs/gcode/M034.html"> M34: SDCard Sorting </a></li> <li><a href="/docs/gcode/M042.html"> M42: Set Pin State </a></li> <li><a href="/docs/gcode/M043.html"> M43: Debug Pins </a></li> <li><a href="/docs/gcode/M048.html"> M48: Probe Accuracy Test </a></li> <li><a href="/docs/gcode/M075.html"> M75: Start Print Job </a></li> <li><a href="/docs/gcode/M076.html"> M76: Pause Print Job </a></li> <li><a href="/docs/gcode/M077.html"> M77: Stop Print Job </a></li> <li><a href="/docs/gcode/M078.html"> M78: Print Job Stats </a></li> <li><a href="/docs/gcode/M080.html"> M80: Power On </a></li> <li><a href="/docs/gcode/M081.html"> M81: Power Off </a></li> <li><a href="/docs/gcode/M082.html"> M82: E Absolute </a></li> <li><a href="/docs/gcode/M083.html"> M83: E Relative </a></li> <li><a href="/docs/gcode/M085.html"> M85: Inactivity Shutdown </a></li> <li><a href="/docs/gcode/M092.html"> M92: Set Axis Steps-per-unit </a></li> <li><a href="/docs/gcode/M100.html"> M100: Free Memory </a></li> <li><a href="/docs/gcode/M104.html"> M104: Set Hotend Temperature </a></li> <li><a href="/docs/gcode/M105.html"> M105: Report Temperatures </a></li> <li><a href="/docs/gcode/M106.html"> M106: Set Fan Speed </a></li> <li><a href="/docs/gcode/M107.html"> M107: Fan Off </a></li> <li><a href="/docs/gcode/M108.html"> M108: Break and Continue </a></li> <li><a href="/docs/gcode/M109.html"> M109: Wait for Hotend Temperature </a></li> <li><a href="/docs/gcode/M110.html"> M110: Set Line Number </a></li> <li><a href="/docs/gcode/M111.html"> M111: Debug Level </a></li> <li><a href="/docs/gcode/M112.html"> M112: Emergency Stop </a></li> <li><a href="/docs/gcode/M113.html"> M113: Host Keepalive </a></li> <li><a href="/docs/gcode/M114.html"> M114: Get Current Position </a></li> <li><a href="/docs/gcode/M115.html"> M115: Firmware Info </a></li> <li><a href="/docs/gcode/M117.html"> M117: Set LCD Message </a></li> <li><a href="/docs/gcode/M119.html"> M119: Endstop States </a></li> <li><a href="/docs/gcode/M120.html"> M120: Enable Endstops </a></li> <li><a href="/docs/gcode/M121.html"> M121: Disable Endstops </a></li> <li><a href="/docs/gcode/M125.html"> M125: Park Head </a></li> <li><a href="/docs/gcode/M126.html"> M126: Baricuda 1 Open </a></li> <li><a href="/docs/gcode/M127.html"> M127: Baricuda 1 Close </a></li> <li><a href="/docs/gcode/M128.html"> M128: Baricuda 2 Open </a></li> <li><a href="/docs/gcode/M129.html"> M129: Baricuda 2 Close </a></li> <li><a href="/docs/gcode/M140.html"> M140: Set Bed Temperature </a></li> <li><a href="/docs/gcode/M145.html"> M145: Set Material Preset </a></li> <li><a href="/docs/gcode/M149.html"> M149: Set Temperature Units </a></li> <li><a href="/docs/gcode/M150.html"> M150: Set RGB Color </a></li> <li><a href="/docs/gcode/M155.html"> M155: Temperature Auto-Report </a></li> <li><a href="/docs/gcode/M163.html"> M163: Set Mix Factor </a></li> <li><a href="/docs/gcode/M164.html"> M164: Save Mix </a></li> <li><a href="/docs/gcode/M165.html"> M165: Set Mix </a></li> <li><a href="/docs/gcode/M190.html"> M190: Wait for Bed Temperature </a></li> <li><a href="/docs/gcode/M200.html"> M200: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M201.html"> M201: Set Print Max Acceleration </a></li> <li><a href="/docs/gcode/M203.html"> M203: Set Max Feedrate </a></li> <li><a href="/docs/gcode/M204.html"> M204: Set Starting Acceleration </a></li> <li><a href="/docs/gcode/M205.html"> M205: Set Advanced Settings </a></li> <li><a href="/docs/gcode/M206.html"> M206: Set Home Offsets </a></li> <li><a href="/docs/gcode/M207.html"> M207: Set Firmware Retraction </a></li> <li><a href="/docs/gcode/M208.html"> M208: Set Firmware Recovery </a></li> <li><a href="/docs/gcode/M209.html"> M209: Set Auto Retract </a></li> <li><a href="/docs/gcode/M211.html"> M211: Software Endstops </a></li> <li><a href="/docs/gcode/M218.html"> M218: Set Hotend Offset </a></li> <li><a href="/docs/gcode/M220.html"> M220: Set Feedrate Percentage </a></li> <li><a href="/docs/gcode/M221.html"> M221: Set Flow Percentage </a></li> <li><a href="/docs/gcode/M226.html"> M226: Wait for Pin State </a></li> <li><a href="/docs/gcode/M240.html"> M240: Trigger Camera </a></li> <li><a href="/docs/gcode/M250.html"> M250: LCD Contrast </a></li> <li><a href="/docs/gcode/M260.html"> M260: I2C Send </a></li> <li><a href="/docs/gcode/M261.html"> M261: I2C Request </a></li> <li><a href="/docs/gcode/M280.html"> M280: Servo Position </a></li> <li><a href="/docs/gcode/M300.html"> M300: Play Tone </a></li> <li><a href="/docs/gcode/M301.html"> M301: Set Hotend PID </a></li> <li><a href="/docs/gcode/M302.html"> M302: Cold Extrude </a></li> <li><a href="/docs/gcode/M303.html"> M303: PID autotune </a></li> <li><a href="/docs/gcode/M304.html"> M304: Set Bed PID </a></li> <li><a href="/docs/gcode/M350.html"> M350: Set micro-stepping </a></li> <li><a href="/docs/gcode/M351.html"> M351: Set Microstep Pins </a></li> <li><a href="/docs/gcode/M355.html"> M355: Case Light Control </a></li> <li><a href="/docs/gcode/M360.html"> M360: SCARA Theta A </a></li> <li><a href="/docs/gcode/M361.html"> M361: SCARA Theta-B </a></li> <li><a href="/docs/gcode/M362.html"> M362: SCARA Psi-A </a></li> <li><a href="/docs/gcode/M363.html"> M363: SCARA Psi-B </a></li> <li><a href="/docs/gcode/M364.html"> M364: SCARA Psi-C </a></li> <li><a href="/docs/gcode/M380.html"> M380: Activate Solenoid </a></li> <li><a href="/docs/gcode/M381.html"> M381: Deactivate Solenoids </a></li> <li><a href="/docs/gcode/M400.html"> M400: Finish Moves </a></li> <li><a href="/docs/gcode/M401.html"> M401: Deploy Probe </a></li> <li><a href="/docs/gcode/M402.html"> M402: Stow Probe </a></li> <li><a href="/docs/gcode/M404.html"> M404: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M405.html"> M405: Filament Width Sensor On </a></li> <li><a href="/docs/gcode/M406.html"> M406: Filament Width Sensor Off </a></li> <li><a href="/docs/gcode/M407.html"> M407: Filament Width </a></li> <li><a href="/docs/gcode/M410.html"> M410: Quickstop </a></li> <li><a href="/docs/gcode/M420.html"> M420: Bed Leveling State </a></li> <li><a href="/docs/gcode/M421.html"> M421: Set Mesh Value </a></li> <li><a href="/docs/gcode/M428.html"> M428: Home Offsets Here </a></li> <li><a href="/docs/gcode/M500.html"> M500: Save Settings </a></li> <li><a href="/docs/gcode/M501.html"> M501: Restore Settings </a></li> <li><a href="/docs/gcode/M502.html"> M502: Factory Reset </a></li> <li><a href="/docs/gcode/M503.html"> M503: Report Settings </a></li> <li><a href="/docs/gcode/M540.html"> M540: Endstops Abort SD </a></li> <li><a href="/docs/gcode/M600.html"> M600: Filament Change </a></li> <li><a href="/docs/gcode/M605.html"> M605: Dual Nozzle Mode </a></li> <li><a href="/docs/gcode/M665.html"> M665: Delta Configuration </a></li> <li><a href="/docs/gcode/M666.html"> M666: Coming Soon </a></li> <li><a href="/docs/gcode/M851.html"> M851: Z Probe Offset </a></li> <li><a href="/docs/gcode/M900.html"> M900: Linear Advance Factors </a></li> <li><a href="/docs/gcode/M906.html"> M906: TMC Motor Current </a></li> <li><a href="/docs/gcode/M907.html"> M907: Set Motor Current </a></li> <li><a href="/docs/gcode/M908.html"> M908: Set Trimpot Pins </a></li> <li><a href="/docs/gcode/M909.html"> M909: DAC Print Values </a></li> <li><a href="/docs/gcode/M910.html"> M910: Commit DAC to EEPROM </a></li> <li><a href="/docs/gcode/M911.html"> M911: TMC OT Pre-Warn Condition </a></li> <li><a href="/docs/gcode/M912.html"> M912: Clear TMC OT Pre-Warn </a></li> <li><a href="/docs/gcode/M913.html"> M913: Set Hybrid Threshold Speed </a></li> <li><a href="/docs/gcode/M914.html"> M914: TMC Bump Sensitivity </a></li> <li><a href="/docs/gcode/M928.html"> M928: Start SD Logging </a></li> <li><a href="/docs/gcode/M999.html"> M999: STOP Restart </a></li> </ul> </li> <li class="dropdown-submenu features"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Marlin Features</a> <ul class="dropdown-menu"> <li><a href="/meta/features/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/features/auto_bed_leveling.html"> Automatic Bed Leveling </a></li> <li><a href="/docs/features/lin_advance.html"> Linear Advance </a></li> <li><a href="/docs/features/unified_bed_leveling.html"> Unified Bed Leveling </a></li> </ul> </li> <li class="divider"> </li> <li><a href="/meta/needs-review/"> Documentation Needing Review </a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-tools"> Tools <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/tools/u8glib/converter.html"> Customize the Bootscreen </a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin/issues"> Bugtracker </a></li> <li><a href="/docs/basics/reporting_bugs.html"> Reporting bugs </a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin"> Source Code Repository </a></li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right visible-lg-block"> <li><a href="https://github.com/MarlinFirmware/MarlinDocumentation/edit/master/_features/lin_advance.md" data-proofer-ignore> <i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>Improve this page</span> </a></li> </ul> </div> </div> </nav> <div class="container" role="main"> <div class="row"> <div class="col-lg-3 col-md-4 visible-lg-block visible-md-block custom-no-padding"> <div class="custom-fixed-sidebar"> <div id="toc"></div> </div> </div> <div class="col-lg-9 col-md-8 custom-bg-white"> <div class="row"> <div class="col-md-12 custom-article"> <p class="text-right pull-right visible-lg-block hidden-print small custom-pt25"> <a href="https://github.com/Sebastianv650" data-toggle="tooltip" data-placement="bottom" title="Visit Sebastianv650's profile on Github"><img class="avatar avatar-small" src="https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=30" alt="Sebastianv650" srcset="https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=30 1x, https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=60 2x, https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=90 3x, https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> </p> <h1 class="custom-article-header">Linear Advance</h1> <hr> <h2 id="background">Background</h2> <p>Under default conditions, extruder axis movement is treated in the same way as the XYZ linear axes. The extruder motor moves in linear proportion to all the other motors, maintaining exactly the same acceleration profile and start/stop points. But an extruder isnât a linear system, so this approach leads, most obviously, to extra material being extruded at the end of each linear movement.</p> <p>Take the common test-cube as an example. Even with the best tuning the corners are usually not sharp, but bleed out. The top solid infill displays roughness where the print direction changes on perimeters. These problems are minor or even imperceptible at low printing speeds, but they become more noticeable and problematic as print speeds increase.</p> <p>Tuning the flow can help, but this may lead to under-extrusion when starting new lines. Some slicers include an option to end extrusion early in each move, but this adds more complexity to the Gcode and has to be re-tuned for different temperatures and materials.</p> <p>Since the root cause is pressure, <code class="highlighter-rouge">LIN_ADVANCE</code> de-couples extrusion from the other axes to produce the correct pressure inside the nozzle, adapting to the printing speed. Once Linear Advance is properly tuned, bleeding edges and rough solid infill should be nearly eliminated.</p> <h2 id="advantages">Advantages</h2> <ul> <li>Better dimensional precision due to reduced bleeding edges.</li> <li>Higher printing speeds are possible without any loss of print quality.</li> <li>Visible and tangible print quality is increased even at lower printing speeds.</li> <li>No longer need high acceleration and jerk values to get sharp edges.</li> </ul> <h2 id="before-using-linear-advance">Before Using Linear Advance</h2> <p>Please consider the following points before you enable <code class="highlighter-rouge">LIN_ADVANCE</code> or you may end up with strange and intractible issues:</p> <ul> <li>Your printer has to produce good prints to start with. The extruder steps/mm value has to be calibrated precisely and should be tuned at low print speeds (20mm/s) to elimiate nozzle pressure effects.</li> <li>Check for any backlash in the extruder drive gears (if any). Excessive backlash will cause strange noises during the extra extruder movements!</li> <li>Some slicers have options to control the nozzle pressure. Common names are: <strong>Pressure advance</strong>, <strong>Coast at end</strong>, <strong>extra restart length after retract</strong>. Disable them all! These features will interact with Linear Advance in unpredictable ways (and the firmware will manage this better). You should also disable âwipe while retractâ or âcombingâ since there should be almost no ooze once youâve calibrated your <code class="highlighter-rouge">K</code> factor (next step).</li> <li>Onve you have Linear Advance calibrated and working well, recheck your retraction distance. You may find it can be set to nearly 0, since pressure control reduces the material pressure at the end of a line to nearly zero. If you normally use 1mm retract length for PLA, try reducing it to 0.5mm with <code class="highlighter-rouge">LIN_ADVANCE</code>.</li> <li>This feature adds extra load to the CPU (and possibly more wear on the extruder). Use a communication speed of 115200 baud or lower to prevent communication errors and âweirdâ movements. Make sure your print host software is using line numbers and checksums. (This is disabled by default in Simplify3D.)</li> <li>Theoretically there should be no âextraâ movements produced by <code class="highlighter-rouge">LIN_ADVANCE</code>, but monitor this closely and let us know. If extra movements are produced, this would tend to increase wear on more fragile parts such as the printed gears of a Wade extruder.</li> <li>This feature was tested mostly with direct-drive extruders. If you have problems with <a href="http://reprap.org/wiki/Erik%27s_Bowden_Extruder">Bowden</a> extruders (due to the high <code class="highlighter-rouge">K</code> values required), try reducing acceleration. Please report any persistent issues to the <a href="https://github.com/MarlinFirmware/Marlin/issues">Marlin Issue Queue</a>.</li> <li>This feature is untested with flexible filaments like Ninjaflex. It probably wonât work (due to the extremely high <code class="highlighter-rouge">K</code> values required).</li> </ul> <h2 id="calibration">Calibration</h2> <p>For a Gregâs Wade extruder start with <code class="highlighter-rouge">K = 75</code> for PLA and <code class="highlighter-rouge">K = 150</code> for nGen. <code class="highlighter-rouge">K</code> is a unique value for an extruder with one filament material. If you use different filament materials like PLA and ABS, youâll need a different <code class="highlighter-rouge">K</code> for each material. This value will be higher for more flexible filaments.</p> <p>Use a test cube with the dimensions 25x25x2mm for testing. Set the acceleration of your printer to a low value like 500mm/sÂ² to eliminate other effects like overshooting fluid filament on direction changes. Set all print speeds for the cube to the same high value, 70mm/s for 0.2mm layer height for example - but be sure to not exceed the flow rate your hotend can handle! Ensure your slicers cooling settings will not slow down the print speed. If it would do this, disable the cooling feature or increase the length and width of the test cube.</p> <p>Print some test cubes, each with another <code class="highlighter-rouge">K</code> value. You can set the value with âM900 <code class="highlighter-rouge">K</code>..â before you start the print, where .. is the value you want it to be. Start with K0 to disable the pressure control, which will give you a reference print how your cube would look like without the feature enabled. Then increase <code class="highlighter-rouge">K</code> maybe in 25 units steps. On every print note down the used <code class="highlighter-rouge">K</code> value.</p> <p>The best value is the one where you have no bleeding edges (bleeding edges = <code class="highlighter-rouge">K</code> too low) and no inward rounded edges (<code class="highlighter-rouge">K</code> too high). Check by holding a metal ruler on each of the 4 sides of the test prints. You will also see and even more feel the difference in the quality of the top infill, where it changes print direction at the perimeters. But top infill alone is no sufficient calibration criterion as it is also influenced by the infill overlap % thatâs between 15-20% in most slicers.</p> <p>When you have found a good value, there are two ways to make them permanent in your firmware. If you are using only one filament material, the best way is to set the <code class="highlighter-rouge">K</code> value inside Configuration_adv.h and reflash the firmware. If you are using different materials, you might want to insert a âM900 <code class="highlighter-rouge">K</code>..â line into the start code inside your slicer profile used for the corresponding material.</p> <h2 id="developer-information">Developer Information</h2> <p>The force required to push the filament through the nozzle aperture depends, in part, on the speed at which the material is being pushed into the nozzle. If the material is pushed faster (=printing fast), the filament needs to be compressed more before the pressure inside the nozzle is high enough to start extruding the material.</p> <p>For a single, fast printed line, this results in under-extrusion at the lineâs starting point (the filament gets compressed, but the pressure isnât high enough) and over-extrusion with a blob at the end of the line (the filament is still compressed when the E motor stops, resulting in oozing).</p> <p>For a complete print, this leads to bleeding edges at corners (corners are stop/end points of lines) and in extreme cases even gaps between perimeters due to under-extrusion at their starting points.</p> <p>The <code class="highlighter-rouge">LIN_ADVANCE</code> pressure control handles this free filament length as a spring, where <code class="highlighter-rouge">K</code> is a spring constant. When the nozzle starts to print a line, it takes the extrusion speed as a reference. Additional to the needed extrusion length for a line segment, which is defined by the slicer, it calculates the needed extra compression of the filament to reach the needed nozzle pressure so that the extrusion length defined by the slicer is really extruded. This is done in every loop of the stepper ISR.</p> <p>During deceleration, the filament compression is released again by the same formula: <code class="highlighter-rouge">advance_steps = delta_extrusion_speed * K</code>. During deceleration, <code class="highlighter-rouge">delta_extrusion_speed</code> is negative, thus the <code class="highlighter-rouge">advance_steps</code> values is negative which leads to a <strong>retract</strong> (or slowed) movement, relaxing the filament again.</p> <p>The basic formula (<code class="highlighter-rouge">advance_steps = delta_extrusion_speed * K</code>) is the same as in the famous JKN pressure control, but with one important difference: JKN calculates the sum of all required advance extruder steps inside the planner loop and distributes them equally over every acceleration and deceleration stepper ISR loop. This leads to the wrong distribution of advance steps, resulting in an imperfect print result. <code class="highlighter-rouge">LIN_ADVANCE</code> calculates the extra steps on the fly in <em>every</em> stepper ISR loop, therefore applying the required steps precisely where needed.</p> <p>For further details and graphs have a look into <a href="https://drive.google.com/file/d/0B5UvosQgK3adaHVtdUI5OFR3VUU/view">this presentation, slides 7-9</a>.</p> <p>In Marlin, all the work is done in the <code class="highlighter-rouge">stepper.*</code> and <code class="highlighter-rouge">planner.*</code> files. In the planner loop, <code class="highlighter-rouge">LIN_ADVANCE</code> checks whether a move needs pressure control. This applies only to print moves, not to travel moves and extruder-only moves (like retract and prime).</p> <p>In the <code class="highlighter-rouge">Stepper::isr</code> method, <code class="highlighter-rouge">LIN_ADVANCE</code> calculates the number of extra steps needed to reach the required nozzle pressure. To avoid missing steps, it doesnât execute them all at once, but distributes them over future calls to the interrupt service routine.</p> <p>Currently there is no check if the extruder acceleration, speed or jerk will exceed the limits set inside Configuration.h. To achieve such checks, the planner needs to be completely rewritten because a variable acceleration rate is needed to compensate too fast pressure advance movements. Iâm quite sure the power of the used ATMega isnât sufficient to do this.. But up to now, I donât know about problems according to this in real world printing.</p> </div> </div> </div> </div> </div> <footer> <div class="container"> <div class="row"> <div class="col-lg-12"> <hr> </div> </div> <div class="row"> <div class="col-lg-8"> <p>Brought to you with <i class="fa fa-heart text-danger" aria-hidden="true"></i> lack of <i class="fa fa-bed" aria-hidden="true"></i> and lots of <i class="fa fa-coffee" aria-hidden="true"></i>. <br> The contents of this website are Â© 2017 under the terms of the <a href="http://www.gnu.org/licenses/gpl-3.0.txt">GPLv3</a> License.</p> </div> <div class="col-lg-4"> <div class="pull-right"> <a href="#top" data-proofer-ignore> Back to top <i class="fa fa-level-up" aria-hidden="true"></i></a> </div> </div> </div> </div> </footer> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76230130-1', {
          'cookieDomain': 'marlinfw.org',
          'siteSpeedSampleRate': 80
      });

      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script> </body> </html>